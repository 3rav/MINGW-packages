# Maintainer: Swarnava Ghosh <swarnavaghosh04@gmail.com>
# Credits: Maximilian Schiller <manimax3@outlook.de> [https://aur.archlinux.org/cgit/aur.git/tree/PKGBUILD?h=krpc-cpp]
_realname=krpc-cpp
pkgbase=mingw-w64-${_realname}
pkgname=${MINGW_PACKAGE_PREFIX}-${_realname}
pkgver=0.4.9
_kspver=1.12.1
pkgrel=1
pkgdesc="KRPC Client for C++"
arch=('any')
url="https://github.com/krpc/krpc"
license=('LGPL3')
groups=()
depends=(
	"${MINGW_PACKAGE_PREFIX}-asio" 
	"${MINGW_PACKAGE_PREFIX}-protobuf")
makedepends=(
	"patch"
	"unzip"
	"${MINGW_PACKAGE_PREFIX}-ninja"
	"${MINGW_PACKAGE_PREFIX}-cmake")
source=("https://github.com/nullprofile/krpc/releases/download/$pkgver-$_kspver/krpc-$pkgver-$_kspver.zip")
md5sums=('9d6b9357447e1adf40e09c1cede52bbb')
noextract=("krpc-$pkgver-$_kspver.zip")

prepare() {
	unzip krpc-$pkgver-$_kspver.zip client/$_realname-$pkgver.zip
	unzip client/$_realname-$pkgver.zip
	rm -rf client *.zip
	cd $_realname-$pkgver
	patch --reverse --strip=1 --input="${startdir}/001-$_realname-cmake.patch"	
}

build() {
	cd "$_realname-$pkgver"
	mkdir cmake-build && cd cmake-build
	cmake ..
	cmake --build .
}

package() {
	cd "$_realname-$pkgver/cmake-build"
	cmake --install . --prefix "$pkgdir/$MINGW_PREFIX"
}