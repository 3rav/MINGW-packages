# Maintainer: Swarnava Ghosh <swarnavaghosh04@gmail.com>
# Credits: Maximilian Schiller <manimax3@outlook.de> [https://aur.archlinux.org/cgit/aur.git/tree/PKGBUILD?h=krpc-cpp]
_realname=krpc-cpp
pkgbase=mingw-w64-${_realname}-git
pkgname=${MINGW_PACKAGE_PREFIX}-${_realname}-git
pkgver=0.4.8
pkgrel=1
pkgdesc="KRPC Client for c++"
arch=('x86_64' 'i686')
url="https://github.com/krpc/krpc"
license=('LGPL3')
groups=()
depends=(
	"${MINGW_PACKAGE_PREFIX}-asio" 
	"${MINGW_PACKAGE_PREFIX}-protobuf")
makedepends=(
	"git"
	"${MINGW_PACKAGE_PREFIX}-make"
	"${MINGW_PACKAGE_PREFIX}-cmake")
source=("https://github.com/krpc/krpc/releases/download/v$pkgver/$_realname-$pkgver.zip" "https://gist.githubusercontent.com/swarnavaghosh04/35a551cc71d884847e519e4190a8d0e2/raw/58e8342c839eaf358149210611420f5b736192c4/krpc-cpp-0.4.8-fix.patch")
md5sums=('143c6230784a699dbe21d62923f12672'
         '3cc580ec8c6fc5b4c093503a5453bde9')

prepare() {
	cd "$_realname-$pkgver"
	patch --forward --strip=1 --input="${srcdir}/krpc-cpp-0.4.8-fix.patch"	
}

build() {
	cd "$_realname-$pkgver"
	mkdir cmake-build && cd cmake-build
	MSYS2_ARG_CONV_EXCL=* \
	cmake .. -G "MinGW Makefiles" -DCMAKE_INSTALL_PREFIX=${MINGW_PREFIX}
	mingw32-make
}

package() {
	cd "$_realname-$pkgver/cmake-build"
	mingw32-make DESTDIR="$pkgdir/" install
}