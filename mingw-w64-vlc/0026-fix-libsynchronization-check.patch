diff --git a/configure.ac b/configure.ac
index f0fa2de..0acd25d 100644
--- a/configure.ac
+++ b/configure.ac
@@ -237,8 +237,13 @@ case "${host_os}" in
     ])
     AC_MSG_CHECKING([if libsynchronization is needed])
     AC_PREPROC_IFELSE([AC_LANG_PROGRAM(
-      [[#if _WIN32_WINNT >= 0x0602
-       # error building for Win8+ and above
+      [[#ifndef _WIN32_WINNT
+       # ifdef _WIN32
+       #  include <windows.h>
+       #  if _WIN32_WINNT >= 0x0602
+       #   error building for Win8+ and above
+       #  endif
+       # endif
        #endif
       ]],[[;]])
     ],[
